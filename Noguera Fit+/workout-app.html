<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NogueraFit</title>
    <link rel="apple-touch-icon" href="images/icon.png"> 
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
        /* --- iOS DESIGN SYSTEM UPDATES --- */
        :root {
            --ios-blue: #007AFF;
            --ios-green: #34C759;
            --ios-gray: #F2F2F7;
            --card-white: #FFFFFF;
            --text-dark: #000000;
            --text-light: #8E8E93;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--ios-gray);
            margin: 0; padding: 0;
            color: var(--text-dark);
            -webkit-user-select: none;
        }

        /* --- TAB NAVIGATION --- */
        .app-header {
            position: sticky; top: 0; z-index: 100;
            display: flex; flex-direction: column;
            background: white; border-bottom: 1px solid #ddd;
        }
        .tab-bar { display: flex; padding: 10px; gap: 10px; }
        .tab-btn {
            flex: 1; padding: 12px; border-radius: 10px;
            border: none; font-weight: 700; font-size: 14px;
            cursor: pointer; transition: 0.2s;
        }
        .tab-workout.active { background: var(--ios-blue); color: white; }
        .tab-nutrition.active { background: var(--ios-green); color: white; }
        .tab-workout:not(.active), .tab-nutrition:not(.active) { background: #eee; color: #888; }

        .container { padding: 20px; max-width: 600px; margin: 0 auto; padding-bottom: 100px; }

        /* --- ACCORDION STYLES --- */
        .accordion-header {
            background: white; padding: 15px; border-radius: 12px;
            margin-top: 10px; display: flex; justify-content: space-between;
            font-weight: 700; border: 1px solid #eee; cursor: pointer;
        }
        .accordion-content { display: none; padding: 5px 0; }
        
        /* --- NUTRITION STYLES --- */
        .habit-card {
            background: white; padding: 20px; border-radius: 15px;
            margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        .counter-btn {
            width: 40px; height: 40px; border-radius: 50%; border: none;
            background: var(--ios-green); color: white; font-size: 20px; font-weight: bold;
        }

        /* Re-using your existing Modal & Progress styles... */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 400px; border-radius: 20px; padding: 20px; }
        .family-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; background: #eee; padding: 10px; border-radius: 12px; }
        .segment-option { text-align: center; padding: 10px; border-radius: 8px; cursor: pointer; background: white; }
        .segment-option.selected { background: var(--ios-blue); color: white; }
        .progress-fill { height: 100%; background: var(--ios-blue); transition: 0.5s; }
        
        /* Generic Helpers */
        .hidden { display: none; }
        .btn-main { background: var(--ios-blue); color: white; width: 100%; padding: 16px; border-radius: 14px; border: none; font-weight: 600; margin-top: 15px; }
        .input-pill { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-top: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="app-header">
    <div class="tab-bar">
        <button id="tab-workout" class="tab-btn tab-workout active" onclick="switchTab('workout')">WORKOUT</button>
        <button id="tab-nutrition" class="tab-btn tab-nutrition" onclick="switchTab('nutrition')">NUTRITION</button>
    </div>
</div>

<div id="workout-section" class="container">
    <h1 style="text-align:center">Noguera Fitness</h1>
    
    <div class="progress-container" style="background:#ddd; height:10px; border-radius:5px; overflow:hidden">
        <div id="visual-progress" class="progress-fill" style="width: 1%;"></div>
    </div>
    <div style="text-align:center; margin:10px 0; font-weight:700">Day <select id="dayInput" onchange="updateProgressUI()" style="font-size:16px; border:none; color:var(--ios-blue); background:none"></select> of 100</div>

    <div id="gym-pass-card" style="background:white; padding:15px; border-radius:12px; text-align:center; margin-bottom:20px;">
        <h3 style="margin:0 0 10px 0">Bretton Woods Code</h3>
        <img src="images/barcode.jpg" alt="Barcode" style="width:70%; border-radius:4px;">
    </div>

    <div class="label" style="font-size:12px; color:#888; font-weight:bold; text-transform:uppercase">Who is training?</div>
    <button id="team-trigger-btn" class="btn-main" style="background:white; color:var(--ios-blue); border:1px solid #ddd;" onclick="openModal()">üë• Select Team (0)</button>

    <div class="label" style="margin-top:20px; font-size:12px; color:#888; font-weight:bold; text-transform:uppercase">Location</div>
    <div class="family-grid" style="grid-template-columns: repeat(4, 1fr);">
        <div class="segment-option selected" id="opt-home" onclick="setLoc('home')">Home</div>
        <div class="segment-option" id="opt-gym" onclick="setLoc('gym')">Gym</div>
        <div class="segment-option" id="opt-cardio" onclick="setLoc('cardio')">Cardio</div>
        <div class="segment-option" id="opt-studio" onclick="setLoc('studio')">Studio</div>
    </div>

    <div id="workout-ui">
        <div class="label" style="margin-top:20px; font-size:12px; color:#888; font-weight:bold; text-transform:uppercase">Workout Mode</div>
        <div style="display:flex; gap:10px; margin-top:5px">
            <button class="tab-btn active" id="btn-mode-random" onclick="setMode('random')" style="background:white; color:black; border:1px solid #ddd">Randomize</button>
            <button class="tab-btn" id="btn-mode-build" onclick="setMode('build')" style="background:white; color:black; border:1px solid #ddd">Build My Own</button>
        </div>

        <div id="build-options" class="hidden">
            <div id="accordion-container"></div>
            <input type="text" id="custom-exercise" class="input-pill" placeholder="Add custom exercise (e.g. Zumba)">
            <button class="btn-main" onclick="generateBuildWorkout()">View Workout ‚ûî</button>
        </div>
        
        <div id="random-options">
            <button class="btn-main" onclick="generateRandomWorkout()">‚ö°Ô∏è Create Random Plan ‚ö°Ô∏è</button>
        </div>
    </div>

    <div id="workout-results" class="hidden">
        <div id="cards-container"></div>
        <button id="finish-btn" class="btn-main" style="background:var(--ios-green)" onclick="handleFinishClick()">‚úÖ Finish & Share</button>
    </div>
</div>

<div id="nutrition-section" class="container hidden">
    <h1 style="text-align:center; color:var(--ios-green)">Daily Nutrition</h1>
    
    <div class="habit-card">
        <div>
            <div style="font-weight:bold">Water Intake</div>
            <div style="font-size:12px; color:#888">Goal: 8 Cups</div>
        </div>
        <div style="display:flex; align-items:center; gap:15px">
            <button class="counter-btn" onclick="updateHabit('water', -1)">-</button>
            <span id="water-count" style="font-size:20px; font-weight:bold">0</span>
            <button class="counter-btn" onclick="updateHabit('water', 1)">+</button>
        </div>
    </div>

    <div class="habit-card">
        <div>
            <div style="font-weight:bold">Veggies & Fruit</div>
            <div style="font-size:12px; color:#888">Check per serving</div>
        </div>
        <input type="checkbox" style="transform:scale(1.5)">
    </div>

    <div class="habit-card">
        <div>
            <div style="font-weight:bold">Healthy Snacks</div>
            <div style="font-size:12px; color:#888">2 allowed per day</div>
        </div>
        <div>
            <input type="checkbox"> <input type="checkbox">
        </div>
    </div>

    <button class="btn-main" style="background:var(--ios-green)" onclick="alert('Nutrition logged locally!')">Save Daily Habits</button>
</div>

<div id="user-modal" class="modal-overlay" onclick="handleOutsideClick(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 style="text-align:center">Who is training?</h2>
        <div class="family-grid">
            <div class="segment-option" onclick="toggleUser('Mami', this)">Mami</div>
            <div class="segment-option" onclick="toggleUser('Papi', this)">Papi</div>
            <div class="segment-option" onclick="toggleUser('Santi', this)">Santi</div>
            <div class="segment-option" onclick="toggleUser('Fran', this)">Fran</div>
            <div class="segment-option" onclick="toggleUser('Dana', this)">Dana</div>
            <div class="segment-option" onclick="toggleUser('Matu', this)">Matu</div>
            <div class="segment-option" onclick="toggleUser('Caro', this)">Caro</div>
            <div class="segment-option" onclick="toggleUser('Sofi', this)">Sofi</div>
            <div class="segment-option" onclick="toggleUser('Andi', this)">Andi</div>
            <div class="segment-option" onclick="toggleUser('Meredith', this)">Meredith</div>
            <div class="segment-option" id="other-btn" onclick="toggleOther()">+ Other</div>
        </div>
        <input type="text" id="other-name-input" class="input-pill hidden" placeholder="Guest Name...">
        <button class="btn-main" onclick="closeModal()">Done</button>
    </div>
</div>

<script>
    let state = { location: 'home', mode: 'random', water: 0 };
    let selectedUsers = [];
    let currentWorkout = [];

    const exerciseDB = [
        { name: "Dumbbell Press", type: "Upper Body", loc: ["home", "gym"] },
        { name: "Lat Pulldown", type: "Upper Body", loc: ["gym"] },
        { name: "Push Ups", type: "Upper Body", loc: ["home", "gym", "cardio"] },
        { name: "Goblet Squat", type: "Lower Body", loc: ["home", "gym"] },
        { name: "Plank", type: "Core", loc: ["home", "gym", "studio"] },
        { name: "Swim (any distance)", type: "Cardio", loc: ["cardio"] },
        { name: "Run (any distance)", type: "Cardio", loc: ["cardio"] },
        { name: "Hot Yoga", type: "Studio", loc: ["studio"] },
        { name: "Reformer Pilates", type: "Studio", loc: ["studio"] }
    ];

    window.onload = function() {
        const select = document.getElementById('dayInput');
        for (let i = 1; i <= 100; i++) {
            let opt = document.createElement('option');
            opt.value = i; opt.innerHTML = i;
            select.appendChild(opt);
        }
        const savedDay = localStorage.getItem('familyWorkoutDay');
        if (savedDay) select.value = savedDay;
        updateProgressUI();
        renderAccordion();
    }

    function switchTab(tab) {
        document.getElementById('workout-section').classList.toggle('hidden', tab !== 'workout');
        document.getElementById('nutrition-section').classList.toggle('hidden', tab !== 'nutrition');
        document.getElementById('tab-workout').classList.toggle('active', tab === 'workout');
        document.getElementById('tab-nutrition').classList.toggle('active', tab === 'nutrition');
    }

    function setLoc(loc) {
        state.location = loc;
        ['home', 'gym', 'cardio', 'studio'].forEach(l => document.getElementById('opt-'+l).classList.remove('selected'));
        document.getElementById('opt-'+loc).classList.add('selected');
        renderAccordion();
    }

    function renderAccordion() {
        const container = document.getElementById('accordion-container');
        container.innerHTML = '';
        const types = [...new Set(exerciseDB.map(ex => ex.type))];
        
        types.forEach(type => {
            const exercises = exerciseDB.filter(ex => ex.type === type && ex.loc.includes(state.location));
            if (exercises.length === 0) return;

            const header = document.createElement('div');
            header.className = 'accordion-header';
            header.innerHTML = `<span>${type} (${exercises.length})</span> <span>‚ñæ</span>`;
            header.onclick = () => {
                const content = header.nextElementSibling;
                content.style.display = content.style.display === 'block' ? 'none' : 'block';
            };

            const content = document.createElement('div');
            content.className = 'accordion-content';
            exercises.forEach(ex => {
                const item = document.createElement('div');
                item.className = 'segment-option';
                item.style.margin = '5px';
                item.innerText = ex.name;
                item.onclick = (e) => {
                    e.stopPropagation();
                    item.classList.toggle('selected');
                    if(item.classList.contains('selected')) currentWorkout.push(ex);
                    else currentWorkout = currentWorkout.filter(w => w.name !== ex.name);
                };
                content.appendChild(item);
            });
            container.appendChild(header);
            container.appendChild(content);
        });
    }

    function generateBuildWorkout() {
        const custom = document.getElementById('custom-exercise').value;
        if (currentWorkout.length === 0 && !custom) return alert("Select an exercise!");
        renderResults();
    }

    function renderResults() {
        const container = document.getElementById('cards-container');
        container.innerHTML = '<h2>Today\'s Plan</h2>';
        currentWorkout.forEach(ex => {
            container.innerHTML += `<div class="habit-card" style="margin-bottom:5px">‚úÖ ${ex.name}</div>`;
        });
        const custom = document.getElementById('custom-exercise').value;
        if(custom) container.innerHTML += `<div class="habit-card">‚úÖ ${custom}</div>`;
        
        document.getElementById('workout-results').classList.remove('hidden');
        document.getElementById('workout-ui').classList.add('hidden');
    }

    function shareToFamily() {
        const day = document.getElementById('dayInput').value;
        let users = selectedUsers.join(' & ') || "The Team";
        let exercises = currentWorkout.map(ex => `‚úÖ ${ex.name}`).join('\n');
        const custom = document.getElementById('custom-exercise').value;
        if(custom) exercises += `\n‚úÖ ${custom}`;

        const message = `üî• *${users}* just completed Day ${day} of 100!!\n\n*The Workout:* \n${exercises}\n\nLet's gooo! üöÄ`;
        
        if (navigator.share) {
            navigator.share({ text: message });
        } else {
            alert(message);
        }
        localStorage.setItem('familyWorkoutDay', parseInt(day) + 1);
        location.reload(); 
    }

    // Modal & Utility Helpers
    function openModal() { document.getElementById('user-modal').style.display = 'flex'; }
    function closeModal() { document.getElementById('user-modal').style.display = 'none'; updateTeamBtn(); }
    function handleOutsideClick(e) { if(e.target.id === 'user-modal') closeModal(); }
    function toggleUser(name, el) { el.classList.toggle('selected'); if(selectedUsers.includes(name)) selectedUsers = selectedUsers.filter(u => u !== name); else selectedUsers.push(name); }
    function updateTeamBtn() { document.getElementById('team-trigger-btn').innerText = `‚úÖ Team (${selectedUsers.length})`; }
    function setMode(m) { state.mode = m; document.getElementById('build-options').classList.toggle('hidden', m!=='build'); document.getElementById('random-options').classList.toggle('hidden', m==='build'); }
    function updateHabit(h, val) { state[h] = Math.max(0, state[h] + val); document.getElementById(h+'-count').innerText = state[h]; }
    function updateProgressUI() { let day = document.getElementById('dayInput').value; document.getElementById('visual-progress').style.width = day + "%"; }
    function handleFinishClick() { confetti(); setTimeout(shareToFamily, 1500); }
</script>    
</html>
